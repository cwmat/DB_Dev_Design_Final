spool test_spatial.lst 


DROP TABLE test_spatial purge;

-- https://docs.oracle.com/database/121/SPATL/simple-example-inserting-indexing-and-querying-spatial-data.htm#SPATL486
-- https://docs.oracle.com/database/122/ADJSN/using-GeoJSON-geographic-data.htm#ADJSN-GUID-2AD827B4-871E-4652-87F3-AC33FE7839AE
-- https://docs.oracle.com/database/121/SPATL/sdo_util-from_wktgeometry.htm#SPATL1234
-- ^ INCLUDES VALIDATION FOR TESTS!
-- CREATE TABLE test_spatial (
--     id         number       PRIMARY KEY,
--     name_desc   varchar2(32),
--     shape       SDO_GEOMETRY
-- );

-- CREATE TABLE test_spatial (
--     id         number       NOT NULL PRIMARY KEY,
--     name_desc   varchar2(32) NOT NULL,
--     geo_doc       varchar2(4000)   NOT NULL 
--         CONSTRAINT test_spatial_json CHECK (geo_doc IS JSON)
-- );

-- INSERT INTO test_spatial VALUES (
--     1,
--     "test",
--     '{
--         "type": "FeatureCollection",
--         "name": "test",
--         "crs": { "type": "name", "properties": { "name": "urn:ogc:def:crs:OGC:1.3:CRS84" } },
--         "features": [
--             { "type": "Feature", "properties": { "STATEFP10": "51", "COUNTYFP10": "760", "TRACTCE10": "040200", "BLOCKCE10": "2039", "GEOID10": "517600402002039", "NAME10": "Block 2039", "MTFCC10": "G5040", "UR10": "U", "UACE10": "74746", "UATYP10": "U", "FUNCSTAT10": "S", "ALAND10": 51876, "AWATER10": 0, "INTPTLAT10": "+37.5690995", "INTPTLON10": "-077.4766539", "GISJOIN": "G51076000402002039", "Shape_area": 51875.513462700001, "Shape_len": 920.40233653099995 }, "geometry": { "type": "Polygon", "coordinates": [ [ [ -77.476192000031233, 37.57021800034952 ], [ -77.475914000279914, 37.569987999836549 ], [ -77.475081000539674, 37.569299000111812 ], [ -77.474803999767374, 37.569069999744123 ], [ -77.474997000122869, 37.568922000353965 ], [ -77.47557899960978, 37.568480999823308 ], [ -77.475772999470081, 37.568334000120537 ], [ -77.475828000001385, 37.568283999918492 ], [ -77.475881999735094, 37.568243999594714 ], [ -77.475962999599091, 37.568182000081435 ], [ -77.476217999403744, 37.567991000244966 ], [ -77.47654500022351, 37.567742999683368 ], [ -77.476638000141534, 37.567674000146141 ], [ -77.476698000537425, 37.567719999840158 ], [ -77.47696000042319, 37.567948000392015 ], [ -77.47774700002563, 37.56861300026064 ], [ -77.47783700034563, 37.568528000248698 ], [ -77.477983999538694, 37.568652000078693 ], [ -77.478426000289758, 37.569026000411988 ], [ -77.478462000478771, 37.56905599986554 ], [ -77.478544999533256, 37.569126000148017 ], [ -77.478573999907283, 37.569150999760332 ], [ -77.478485000520067, 37.569236999945907 ], [ -77.47844200023593, 37.569198999769576 ], [ -77.478010000010684, 37.569505000178239 ], [ -77.477610000259489, 37.569788999804167 ], [ -77.477085999665661, 37.570221999796892 ], [ -77.477022999376885, 37.570265000338338 ], [ -77.476949000238761, 37.570301999945144 ], [ -77.47686500002861, 37.570330999627387 ], [ -77.476775999855732, 37.570349999719504 ], [ -77.476696999744831, 37.570352999948256 ], [ -77.476663000010788, 37.57035500001669 ], [ -77.476606999693374, 37.570352999957194 ], [ -77.476495999507748, 37.570335999805863 ], [ -77.476389000443604, 37.570306000355664 ], [ -77.476192000031233, 37.57021800034952 ] ] ] } }
--         ]
--     }'
-- )

-- commit;

-- SELECT json_value (geo_doc, '$.features[0].geometry'
--                     RETURNING SDO_GEOMETRY
--                     ERROR ON ERROR)
--     FROM test_spatial;


CREATE TABLE test_spatial (
    id         number       NOT NULL PRIMARY KEY,
    name_desc   varchar2(32) NOT NULL,
    geo_doc       SDO_GEOMETRY   NOT NULL
);


INSERT INTO test_spatial VALUES (
    1,
    'test',
    SDO_UTIL.FROM_WKTGEOMETRY ('Polygon ((-77.47619200003123296 37.57021800034952008, -77.47591400027991426 37.56998799983654891, -77.47508100053967439 37.56929900011181189, -77.47480399976737431 37.56906999974412287, -77.47499700012286894 37.56892200035396456, -77.47557899960978034 37.5684809998233078, -77.475772999470081 37.56833400012053659, -77.47582800000138548 37.5682839999184921, -77.47588199973509404 37.5682439995947135, -77.47596299959909061 37.56818200008143549, -77.47621799940374387 37.56799100024496596, -77.47654500022350987 37.56774299968336805, -77.47663800014153423 37.56767400014614111, -77.47669800053742506 37.56771999984015764, -77.47696000042319042 37.56794800039201476, -77.47774700002563009 37.56861300026064043, -77.47783700034563026 37.56852800024869765, -77.47798399953869364 37.56865200007869277, -77.47842600028975824 37.56902600041198781, -77.47846200047877119 37.56905599986554023, -77.47854499953325558 37.5691260001480174, -77.47857399990728311 37.5691509997603319, -77.47848500052006671 37.56923699994590748, -77.47844200023592975 37.56919899976957566, -77.47801000001068417 37.56950500017823913, -77.47761000025948874 37.56978899980416742, -77.47708599966566112 37.57022199979689248, -77.47702299937688508 37.57026500033833827, -77.4769490002387613 37.57030199994514419, -77.4768650000286101 37.57033099962738731, -77.47677599985573238 37.57034999971950384, -77.47669699974483137 37.5703529999482555, -77.4766630000107881 37.57035500001668993, -77.47660699969337372 37.57035299995719413, -77.47649599950774757 37.57033599980586303, -77.47638900044360355 37.57030600035566437, -77.47619200003123296 37.57021800034952008))')
);

CREATE INDEX test_spatial_index ON test_spatial (geo_doc)
    INDEXTYPE IS MDSYS.SPATIAL_INDEX;






SELECT id
    FROM test_spatial
    WHERE SDO_CONTAINS (test_spatial.geo_doc,
                        SDO_GEOMETRY('POINT(-77.476508621284 37.56907082647)', 8307)
                        ) = 'TRUE';

SELECT id
    FROM test_spatial
    WHERE SDO_CONTAINS (test_spatial.geo_doc,
                        SDO_GEOMETRY('POINT(-77.472431663581 37.570572863518)', 8307)
                        ) = 'TRUE';
-- test if inside: POINT(-77.476508621284 37.56907082647)
-- test if outside: POINT(-77.472431663581 37.570572863518)

INSERT INTO user_sdo_geom_metadata
        -- (TABLE_NAME,
        -- COLUMN_NAME,
        -- DIMINFO,
        -- SRID) 
    VALUES (
        'test_spatial',
        'geo_doc',
        SDO_DIM_ARRAY    -- DIMINFO attribute, stores dimension bounds and tolerance
        (
            SDO_DIM_ELEMENT
            (
            'LONGITUDE', -- dimension name for first dimension
            -180,        -- SDO_LB - lower bound of the dimension values
            180,         -- upper bound for the dimension values
            0.5          -- tolerance for values - 0.5 meters   
            ),
            SDO_DIM_ELEMENT
            (
            'LATITUDE', -- dimension name for second dimension
            -90,        -- SDO_LB - lower bound of the dimension values
            90,         -- upper bound for the dimension values
            0.5          -- tolerance for values - 0.5 meters   
            )
        ),
        8307
    );

spool off